{% import "bootstrap/wtf.html" as wtf %}
{% extends 'main.html' %}
{% block content %}
<div class="container" style="margin-top: 5%; margin-bottom: 5%;">
  <h2>Chart</h2>
  <canvas style="margin-top: 5%;" id="chart_currency" width="400" height="200"></canvas>
  <div style="margin-left: 60%; margin-top: 5%; margin-bottom: 5%;">
    <!-- <div id='app'>
      <button v-if='isActive' v-on:click='isActive = !isActive' id="addData" type="button" class="btn btn-primary">Add Prediction</button>
      <button v-else v-on:click='isActive = !isActive' id="removeData" type="button" class="btn btn-primary">Drop Prediction</button>
    </div> -->
    <p>
    <button id="addData" type="button" class="btn btn-primary">Add Prediction</button>
    <button id="removeData" type="button" class="btn btn-primary">Drop Prediction</button>
    <a href="{{ url_for('main') }}"><button type="button" class="btn btn-primary">Return</button></a>
    </p>
  </div>
</div>
<style>
  canvas {
    -moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
  }
</style>
<!-- <script>
  var app = new Vue({
      el: '#app',
      data: {      
          isActive: true,
          
      }
  });
</script> -->
<script>
  var timeFormat = 'DD/MM/YYYY';

  // var labels_hist = [];
  // var data_hist = [];

  var dataPoints = [];
  '{% for key, value in rates.items() %}'
    // labels_hist.push('{{ key }}')
    // data_hist.push('{{ value }}')
    dataPoints.push({
      x: '{{ key }}',
      y: '{{ value }}'
    })
  '{% endfor %}'

  // document.getElementById("demo").innerHTML = JSON.stringify(dataPoints)
  
  var config = {
      type: 'line',
      data: {
          // labels: labels_hist,
          datasets: [{
              label: 'Historical',
              // data: data_hist,
              data: dataPoints,
              fill: false,
              backgroundColor: window.chartColors.blue,
              borderColor: window.chartColors.blue,
              pointRadius: 1,
              lineTension: 0,
              borderWidth: 2
          }]
      },
      // Configuration options go here
      options: {
        // responsive: false,
        title: {
          display: true,
          text: 'EUR - {{ unit }}',
          fontSize: 20,
          position: 'top',
          padding: 15,
        },
        tooltips: {
          mode: 'nearest',
          intersect: false,
        },
        hover: {
          mode: 'index',
        },
        annotation: {
        annotations: [
          {
            drawTime: "afterDatasetsDraw",
            type: "line",
            mode: "vertical",
            scaleID: "x-axis-0",
            value: 3.8,
            borderWidth: 5,
            borderColor: "red",
            label: {
              content: "TODAY",
              enabled: true,
              position: "top"
            }
          }
        ]
      },
        scales: {
          xAxes: [{
            type: 'time',
            display: true,
						ticks: {
							callback: function(dataLabel, index) {
								// Hide the label of every 2nd dataset. return null to hide the grid line too
								return index % 2 === 0 ? dataLabel : '';
              },
              autoSkip: false,
              maxRotation: 65,
              minRotation: 65
            },
            time: {
              parser: timeFormat,
              tooltipFormat: 'll',
            },
            scaleLabel: {
              display: true,
              labelString: 'Date'
            }
          }],
          yAxes: [{
            ticks: {
              beginAtZero: false,
            },
            gridLines: {
              drawBorder: false,
            },
            scaleLabel: {
              display: true,
              labelString: 'Rates',
            }
          }]
        },
        legend: {
          display: true,
          position: 'right',
        },
      }
  };

  window.onload = function() {
    var ctx = document.getElementById('chart_currency').getContext('2d');
    window.chart = new Chart(ctx, config);
  };

  document.getElementById('addData').addEventListener('click', function() {
    // var labels_pred = [];
    // var data_pred = [];
    var dataPoints2 = [];
    // dataPoints2.push(JSON.stringify(dataPoints.slice(-1)[0]))
    dataPoints2.push({
      x: dataPoints.slice(-1).map(({x}) => x)[0],
      y: dataPoints.slice(-1).map(({y}) => y)[0]
    })
    '{% for key, value in results.items() %}'
        // labels_pred.push('{{ key }}')
        // data_pred.push('{{ value }}')
        dataPoints2.push({
          x: '{{ key }}',
          y: '{{ value }}'
        })
    '{% endfor %}'
    var dataset_pred = {
      label: 'Predictive',
      // data: data_pred,
      data: dataPoints2,
      fill: false,
      backgroundColor: window.chartColors.red,
      borderColor: window.chartColors.red,
      pointRadius: 1,
      lineTension: 0,
      borderWidth: 2
    }
    // config.data.datasets.forEach(function(dataset) {
		// 			dataset.data.push(randomScalingFactor());
		// });
    // config.data.labels.push(labels_pred)
    config.data.datasets.push(dataset_pred)
    window.chart.update();
  });

  document.getElementById('removeData').addEventListener('click', function() {
    config.data.datasets.pop();
    window.chart.update();
  });

</script>
{% endblock %}
